<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Test Ember 'vocabulary' app</title>
	<link rel='stylesheet' href='__temp__/Content/bootstrap.min.css' />
</head>
<body>
	<style>
		/* COMMON */
		.full-height{
			height:100%;
		}
		.fill-absolute{
			width:100%;
			height:100%;
			position:absolute;
		}

		.flex-centered{
			display: flex;
			justify-content: center;
			align-items: center;
		}

		#content{
			position: relative;
		}

		.sp-header{
			padding-left: 5px;
			font-size:14px;
			border:0;
			border-bottom: solid 1px #e5e5e5;
			text-transform: uppercase;
			background: rgb(235,248,253);
			margin-bottom: 5px;
		}
		.sp-block td{
			font-size: 11px;
		}
		.words-col{
			border: 0;
			border-right: solid 1px #e5e5e5;
		}
		.words-col:last-child{
			border: 0;
		}
		.word-translation{
			display:flex;
			justify-content:space-between;
			align-items:center;
			padding: 0 5px;
		}
		.word-translation:hover{
			background: #f0f0f0;
		}

		.word,.translation{
			width: 45%;
			overflow: hidden;
			text-wrap: nowrap;
			text-overflow: ellipsis;
		}

		.show-details{
			width: 10%;
			cursor: pointer;
		}
		.show-details:hover{
			background: rgb(240,173,78);
		}

		/* LEARNING */
		.learning-col{
			position: relative;
			border: solid 1px #e5e5e5;
			padding:0;
			width:600px;
		}

		.stencil{
		    background:transparent;
		    display: flex;
		    z-index: 1989;	/* should overlay learning cards */
		    flex-direction:column;
		}
		.top-block, .bottom-block{
		    flex-grow:1;
		}
		.magnifier-block{
		    height:300px;
		    position:relative;
		    border-top: solid 1px #e5e5e5;
		    background: #FFF;
		    box-sizing: border-box;
		    overflow:hidden;
		}

		.pull-bottom{
			bottom: 0;
		}
		  
		.learning-cards{
			overflow: hidden;
		}

		.learning-cards-shadow{
			z-index: 1988;
			opacity: 0.2;
			overflow: hidden;
		}

		.learning-card{
			padding:5px;
			height: 300px;	/* same size as mignifier window */
		}

		.learn-toolbox{
			display:flex;
		}
		.learn-toolbox>.btn{
			flex-grow:1;
		}
		.absolute-full-width{
			position: absolute;
			width:100%;
		}
		.words-progress{
			font-size: 16px;
			padding: 0 20px;
			vertical-align: middle;
		}

		.words-nav{
			line-height:36px;
		}

		.word-description{
			padding-left: 20px;
		}

		.word-original-wrap{
			vertical-align: middle;
			margin: 10px 0;
		}

		.word-original{
			font-size: 21px;
		}

		.word-picture{
			height: 100px;
			margin: 5px 0;
		}
		.speach-part{
			color: #2d8d17;
  			font-style: italic;
  			margin-right:4px;
  			font-size: 0.9em;
		}
		.word-translations{
			margin-left: 10px;
		}

		.word-audio{
			width:24px;
			height:24px;
			display: inline-block;
			background: url('../../Content/images/sound.png');
			background-size: contain;
			vertical-align: -7px;
		}  

		.navbar.topbar {
		    width: 100%;
		    background: rgba(0,0,0,0.86);
		    height: 34px;
		    line-height: 1;
		    font-size: 13px;
		    min-height: 34px;	/* rewrite bootstrap.css */
		}

		.topbar>.container {
		    height: 34px;
		    text-align: left;
		    position: relative;
		}

		.topbar-navitems.navbar-collapse {
			padding-left: 0;
			padding-right: 0;
		}

		.topbar-navitems li{
		    color: #e0e0e0;
		    text-decoration: none;
		    display: inline-block;
		    height: 24px;
		    padding: 10px 7px 0 7px;
		    vertical-align: top;
		    font-size: 13px;
		}

		.container.toolbox {
			padding-top: 35px;
		}

	</style>

	<div class="topbar navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div class="topbar-navitems navbar-collapse collapse">
            	<div class="topbar-menu-links">
	                <ul class="nav navbar-nav">
	                    <li>About</li>
	                    <li>Cool Translator</li>
	                    <li>Babbel.com</li>
	                    <li>Duolingo.com</li>
	                </ul>
            	</div>
				<div class="topbar-user-links pull-right">
					<ul class="nav navbar-nav">
						<li>Sign Up</li>
						<li>Sign In</li>
	                </ul>
				</div>
            </div>
        </div>
    </div>

	<script type='text/x-handlebars' id='application'>
		{{outlet "root"}}
		<div id='toolbox' class="container toolbox">
			<div class="row">
				<div class="col-xs-4">
					<ol class="breadcrumb">
					  	<li>{{userName}}</li>
					  	<li class="dropdown">
						  <a class="dropdown-toggle" role="button" id="langugesDropdown" data-toggle="dropdown" href="#">
						    {{language}}
						    <span class="caret"></span>
						  </a>
						  <ul class="dropdown-menu">
						    <li><a href="#">Es</a></li>
						    <li><a href="#">Fr</a></li>
						    <li><a href="#">Pt</a></li>
						  </ul>
					  	</li>
					  	<li class="active dropdown">
						  	<a class="dropdown-toggle" role="button" id="booksDropdown" data-toggle="dropdown" href="#">
						    	{{book}}
						    	<span class="caret"></span>
						  	</a>
						  	<ul class="dropdown-menu">
						    	<li><a href="#">Poliglot</a></li>
						    	<li><a href="#">Martin Eden</a></li>
						    	<li><a href="#">1984</a></li>
						  	</ul>
					  	</li>
					</ol>
				</div>
				{{outlet "toolbox"}}
			</div>
		</div>
		<div id="content" class="container">
			{{outlet "content"}}
		</div>
	</script>

	<script type='text/x-handlebars' id="components/speachpart-block">
		<div class="sp-block">
			<div class="sp-header">{{title}}</div>
			<table class="table table-striped">
				{{#each words as |pair|}}
					<tr class='word-translation'>
						<td class="word" title='{{word}}'>{{pair.word}}</td>
						<td class="show-details text-center">...</td>
						<td class="translation text-right" title='{{translation}}'>{{pair.translation}}</td>
					</tr>
				{{/each}}
			</table>
		</div>
	</script>

	<script type='text/x-handlebars' id='words'>
		<div class="row full-height">
			<div class="words-col  col-xs-2 full-height">
				{{speachpart-block title="Pronouns" words=model.pronouns }}
				{{speachpart-block title="Prepositions" words=model.prepositions }}
				{{speachpart-block title="Conjunctions" words=model.conjunctions }}
			</div>
			<div class="words-col  col-xs-2 full-height">
				{{speachpart-block title="Nouns" words=model.nouns }}
			</div>
			<div class="words-col  col-xs-2 full-height">
				{{speachpart-block title="Verbs" words=model.verbs }}
			</div>
			<div class="words-col  col-xs-2 full-height">
				{{speachpart-block title="Adjectives" words=model.adjectives }}
			</div>
			<div class="words-col  col-xs-2 full-height">
				{{speachpart-block title="Adverbs" words=model.adverbs }}
			</div>
			<div class="words-col  col-xs-2 full-height">
				{{speachpart-block title="Articles" words=model.articles }}
				{{speachpart-block title="Interjections" words=model.interjections }}
			</div>
		</div>
	</script>

	<script type='text/x-handlebars' id='wordsRoot'>
		<div id="install_ct_alert" class="popover">
		   	<div class="arrow"></div>
   			<h3 class="popover-title">JavaScript Access</h3>

		   	<div class="popover-content">
		          You should install <a href="localhost:3000/cooltranslator">Cool Translator</a> if you wanna add new words to your vocabulary. Currently it is available for Chrome browser.
		   	</div>
		</div>
	</script>
		
	<script type='text/x-handlebars' id='wordsToolbox'>
		<div class="col-xs-6">
			<form id="word_input_form" class="input-group">
				{{input value=inputWord class="form-control input-sm"  placeholder="Type word..."}}
		      	<span class="input-group-btn">
		        	<button {{bind-attr class=":btn :btn-sm inputWord:btn-info"}} type="submit" >
		        		<span class="glyphicon glyphicon-add" aria-hidden="true"></span>
		        		Add
		        	</button>
		      	</span>
		    </form>
		</div>
		<div class="col-xs-2">
			{{#link-to "learn"}}<button class="btn btn-sm btn-success" type="button">Learn</button>{{/link-to}}
			{{#link-to "exam"}}<button class="btn btn-sm btn-warning" type="button">Examenate</button>{{/link-to}}
		</div>
	</script>
	
	<script type='text/x-handlebars' id='learn'>
		<div class="flex-centered fill-absolute">
			<div class="learning-col full-height">
			    <div class="stencil fill-absolute">
			    	<div class="top-block"></div>
			    	<div class="magnifier-block">
			    		<div class="learning-cards fill-absolute">
							<div class="learning-card">{{word-description}}</div>
							<div class="learning-card">Voluptates ut totam doloribus, voluptas, beatae dolor possimus rem, quae numquam ipsum recusandae, exercitationem eaque? Porro numquam eius velit! Natus, veniam architecto, vero fugit accusantium ipsum laborum quis cumque minima error reprehenderit quae deleniti nisi veritatis tempore. Ut, nisi eveniet eaque iste beatae facilis, ab libero. Voluptas nobis aliquam repellat placeat impedit quis, et eum sequi temporibus perspiciatis nostrum nulla expedita odio rerum. Assumenda esse nemo, odio reiciendis, nisi a in quo fugit dicta dolorem? Consequatur iusto voluptatum id error, et, eaque eveniet iste nemo fugit, voluptatem dignissimos voluptatibus eligendi repudiandae atque expedita sunt delectus explicabo. Modi beatae eum dolorem.</div>
							<div class="learning-card">Corporis ullam corrupti, earum aliquid similique sapiente beatae, id inventore amet, architecto ducimus esse repellat magnam, quia quaerat neque. Nihil cumque nesciunt at odio totam, dignissimos velit atque, iure voluptate, architecto aliquid quasi voluptas quisquam dolore dolores, ipsum laborum sed iusto. Pariatur officia nulla tenetur cumque modi maxime ducimus odit obcaecati, vero harum maiores quisquam placeat est minima molestiae temporibus nostrum! Consectetur tenetur illo accusamus officiis quos, doloremque ut sit deserunt, ducimus enim nobis minus tempore qui. Architecto dolore eaque aspernatur, reiciendis sed officia magnam at, necessitatibus, voluptatibus delectus consectetur quidem voluptas repudiandae. Repudiandae, officiis fugit quia distinctio, sequi totam.</div>
							<div class="learning-card">Consectetur obcaecati laboriosam ut, sit aliquam, praesentium. Rem neque, cumque quibusdam fugiat praesentium fugit quidem, iure corrupti aperiam eum accusamus, expedita quis nam maiores, aliquid eos aut. Iure praesentium ratione quaerat, dolores officia voluptate. Dolore delectus eos molestiae et repellat, pariatur velit error inventore nam praesentium nostrum, iusto mollitia ducimus itaque natus ea recusandae dolorem, corporis illo. Repudiandae ex dolor dolores laudantium sit modi praesentium earum non, omnis nemo nihil aperiam blanditiis, in iure veritatis. Nulla perspiciatis dolor minima incidunt tempore earum iusto repudiandae laudantium quas ullam, illum sunt non vero sint possimus repellendus illo exercitationem voluptas quo, autem recusandae.</div>
						</div>
						<div class="fill-absolute">
							<div class="learn-toolbox absolute-full-width pull-bottom">
								<button class="btn btn-info btn-xs">More</button>
								<button class="btn btn-success btn-xs">I got it, next...</button>
							</div>
						</div>
					</div>
					<div class="bottom-block"></div>
			    </div>
	
		
				<div class="learning-cards-shadow fill-absolute">
					<div class="learning-card"></div>
					<div class="learning-card">{{word-description}}</div>
					<div class="learning-card">Voluptates ut totam doloribus, voluptas, beatae dolor possimus rem, quae numquam ipsum recusandae, exercitationem eaque? Porro numquam eius velit! Natus, veniam architecto, vero fugit accusantium ipsum laborum quis cumque minima error reprehenderit quae deleniti nisi veritatis tempore. Ut, nisi eveniet eaque iste beatae facilis, ab libero. Voluptas nobis aliquam repellat placeat impedit quis, et eum sequi temporibus perspiciatis nostrum nulla expedita odio rerum. Assumenda esse nemo, odio reiciendis, nisi a in quo fugit dicta dolorem? Consequatur iusto voluptatum id error, et, eaque eveniet iste nemo fugit, voluptatem dignissimos voluptatibus eligendi repudiandae atque expedita sunt delectus explicabo. Modi beatae eum dolorem.</div>
					<div class="learning-card">Corporis ullam corrupti, earum aliquid similique sapiente beatae, id inventore amet, architecto ducimus esse repellat magnam, quia quaerat neque. Nihil cumque nesciunt at odio totam, dignissimos velit atque, iure voluptate, architecto aliquid quasi voluptas quisquam dolore dolores, ipsum laborum sed iusto. Pariatur officia nulla tenetur cumque modi maxime ducimus odit obcaecati, vero harum maiores quisquam placeat est minima molestiae temporibus nostrum! Consectetur tenetur illo accusamus officiis quos, doloremque ut sit deserunt, ducimus enim nobis minus tempore qui. Architecto dolore eaque aspernatur, reiciendis sed officia magnam at, necessitatibus, voluptatibus delectus consectetur quidem voluptas repudiandae. Repudiandae, officiis fugit quia distinctio, sequi totam.</div>
					<div class="learning-card">Consectetur obcaecati laboriosam ut, sit aliquam, praesentium. Rem neque, cumque quibusdam fugiat praesentium fugit quidem, iure corrupti aperiam eum accusamus, expedita quis nam maiores, aliquid eos aut. Iure praesentium ratione quaerat, dolores officia voluptate. Dolore delectus eos molestiae et repellat, pariatur velit error inventore nam praesentium nostrum, iusto mollitia ducimus itaque natus ea recusandae dolorem, corporis illo. Repudiandae ex dolor dolores laudantium sit modi praesentium earum non, omnis nemo nihil aperiam blanditiis, in iure veritatis. Nulla perspiciatis dolor minima incidunt tempore earum iusto repudiandae laudantium quas ullam, illum sunt non vero sint possimus repellendus illo exercitationem voluptas quo, autem recusandae.</div>
					<div class="learning-card"></div>
				</div>
			</div>
		</div>
	</script>

	<script type='text/x-handlebars' id='components/word-description'>
		<div class="word-picture text-center">
			<img src="http://d144fqpiyasmrr.cloudfront.net/uploads/picture/128539.png">
		</div>
		<div class="word-description">
			<div class="word-original-wrap">
				<span class="word-original">vigil</span>
				<span class="word-transctiption">[vˈɪdʒɪl]</span>
				<span class="word-audio"/>
			</div>
			<ul class="word-translations list-unstyled">
				<li><span class='speach-part'>cущ.</span>дежурство</li>
			</ul>
		</div>
	</script>

	<script type='text/x-handlebars' id='learnToolbox'>
		<div class="col-xs-8 text-right">
			<nav class="words-nav">
				<button class="btn btn-primary btn-sm" type="button">Previous word</button>
				<span class="words-progress"><b>8</b> of <b>20</b></span>
				<button class="btn btn-primary btn-sm" type="button">Next word</button>
			</nav>
		</div>
	</script>

	<script type='text/x-handlebars' id='exam'>
		<h1>Hello from EXAM Route</h1>
	</script>

</body>
<script src="__temp__/vendor/jquery-1.10.2.js"></script>
<script src="http://builds.emberjs.com/release/ember-template-compiler.js"></script>
<script src="__temp__/vendor/ember.debug.js"></script>
<script src="http://builds.emberjs.com/release/ember-data.prod.js"></script>
<script src="__temp__/vendor/bootstrap.min.js"></script>
<script src="__temp__/vendor/bootstrap-modal-popover.js"></script>
<script src="__temp__/vendor/jquery.scrollTo.min.js"></script>
<script src="vocabulary.js"></script>
<script src="ct_adapter.js"></script>

<script>
	Vocabulary.Router.map(function(){
		this.resource('words',{path:'/'});
		this.resource('learn');
		this.resource('exam');
	});

	Vocabulary.ApplicationController = Ember.Controller.extend({
		userName: 'wsbaser',
		langPair: { sourceLang:'en', targetLang:'ru' },
		book: 'Stranger in a strange land',
		init: function(){
			var self = this;
			$(document).ready(function(){
				$(window).resize(function(){
					self.setContentHeight();
				}.bind(this));
				self.setContentHeight();
			});
		}.on('init'),
		setContentHeight: function(){
			var height = $(window).height()-$('#toolbox').height();
			console.log('setContentHeight');
			$('#content').css('height',height+'px');
			var heightChangedEvent = new CustomEvent("heightChanged", {detail: height});
			$('#content')[0].dispatchEvent(heightChangedEvent);
		}
	});

	Vocabulary.WordsRoute = Ember.Route.extend({
		renderTemplate: function() {
			this.render('wordsRoot', { outlet: 'root' });
    		this.render('wordsToolbox', { outlet: 'toolbox' });
    		this.render('words', { outlet: 'content' });
  		},
  		setupController: function(controller, model){
		    this._super(controller, model);
		    Ember.run.schedule('afterRender', this, function () {
		    	console.log('init popover');
		      	$('#install_ct_alert').modalPopover({
				    target: '#word_input_form',
				    placement: 'bottom',
				    backdrop: true
				});
		    });
  		},
		model: function(params){
			return {
				pronouns:[
					{word:'kindergarten', translation:'перевод'},
					{word:'doppelganger',translation:'перевод'},
					{word:'I',translation:'Я'},
					{word:'You',translation:'Ты'},
					{word:'He',translation:'Он'}],
				prepositions:[
					{word:'To',translation:'в'},
					{word:'At',translation:'на'},
					{word:'On',translation:'на'}],
				conjunctions:[
					{word:'And',translation:'и'},
					{word:'Or',translation:'или'},
					{word:'But',translation:'но'}],
				nouns:[
					{word:'Dog',translation:'Собака'},
					{word:'Cat',translation:'Кошка'},
					{word:'Garden',translation:'Сад'}],
				verbs:[
					{word:'Run',translation:'Бежать'},
					{word:'Go',translation:'Идти'},
					{word:'Have',translation:'Иметь'}],
				adjectives:[
					{word:'Angry',translation:'Сердитый'},
					{word:'Brave',translation:'Храбрый'},
					{word:'Healthy',translation:'Здоровый'}],
				adverbs:[
					{word:'Badly',translation:'Плохо'},
					{word:'Fully',translation:'Полностью'},
					{word:'Hardly',translation:'Едва'}],
				articles:[
					{word:'A',translation:''},
					{word:'The',translation:''},
					{word:'An',translation:''}],
				interjections:[
					{word:'aha!',translation:''},
					{word:'gosh!',translation:''},
					{word:'hi!',translation:''}]
			};
		}
	});

	Vocabulary.WordsController = Ember.Controller.extend({
		inputWord: "",
		translator: {},
		applicationCtrl: Ember.inject.controller('application'),
		init: function(){
			this.initSiteDialog();
		}.on('init'),
		initSiteDialog:function(){
			var self = this;
			var ctAdapter =  new CTAdapter();
			this.set('ctAdapter', ctAdapter);
			var langPair = this.get('applicationCtrl').langPair;
			$('#word_input_form').off('submit', this.showInstallCTAlert);
			ctAdapter.initSiteDialog(langPair, '#word_input_form', function(){
				if(ctAdapter.extensionIsActive)
					return;
				$('#word_input_form').on('submit', self.showInstallCTAlert);
			});
		},
		showInstallCTAlert: function(){
			console.log('show popover');
			$('#install_ct_alert').modalPopover('show');
			return false;
		}
	});

	Vocabulary.SpechPartBlock = Ember.Component.extend({
		words:[]
	});

	window.CARD_HEIGHT = 300;

	Vocabulary.LearnRoute = Ember.Route.extend({
		renderTemplate: function(){
			this.render('learnToolbox', {outlet:'toolbox'});
			this.render('learn',{outlet:'content'});
		}
	});

	Vocabulary.LearnController = Ember.Controller.extend({
		cards:[],
		curCardIndex:0,
		showNeighbourCard: function(dir){
			var cardsCount = 3;// this.get('cards').length;
			var index = this.get('curCardIndex')+dir;
			console.log('nextCardIndex: '+index);
			if(index<0||index>=cardsCount)
				return;
			this.set('curCardIndex', index);
			var scrollOffset =
				(dir>0?
				'+='+CARD_HEIGHT:
				'-='+CARD_HEIGHT)+'px';
			var SCROLL_TIME = 300;	// мс.
			$('.learning-cards-shadow').scrollTo(scrollOffset, SCROLL_TIME);
			$('.learning-cards').scrollTo(scrollOffset, SCROLL_TIME);
		},
		function(index){
			if(index<0 || index>(this.get('cards').length-1))
				return;
			this.set('cardIndex',index);
			console.log('scoll to card index: '+ index);
		},
	});

	Vocabulary.LearnView = Ember.View.extend({
		didInsertElement: function(){
			var self = this;
			$('#content')[0].addEventListener('heightChanged', function(){
				var offset = CARD_HEIGHT-$('.stencil>.top-block').height();
				console.log('scroll cards shadow to ' + offset);
				$('.learning-cards-shadow').scrollTop(offset);
			});
			$('.learning-col').bind('mousewheel', function(event) {
				self.get('controller').showNeighbourCard(event.originalEvent.wheelDeltaY>0?-1:1);
				return true;
			});
		},
		willRemoveElement:function(){
			$('.learning-col').unbind('mousewheel');
		}
	});
</script>

</html>
